import{a as ot,d as rt,e as dt,f as lt}from"./chunk-L2N6OSTQ.js";import{a as ct,b as mt}from"./chunk-SCFAFR5F.js";import{a as Z,b as tt,c as et,g as it,h as nt,i as st}from"./chunk-DZWPVE7X.js";import{a as A,c as F}from"./chunk-ZQOI7BBG.js";import{c as at}from"./chunk-PNK3MDVW.js";import{a as ut,b as N}from"./chunk-YUGJEFV7.js";import{a as pt,b as _t}from"./chunk-KVGMTMPN.js";import{b as G,c as k,e as J,h as S,k as K,n as Q,q as X}from"./chunk-GJAULJBT.js";import{a as R,c as O,d as $}from"./chunk-K3W4U4ZG.js";import{a as U,b as H,c as P,d as W,f as Y,h as z}from"./chunk-COWIBSMX.js";import"./chunk-KW5VBN5V.js";import{O as L,U as j,V as q}from"./chunk-PT23TE2W.js";import"./chunk-Q64FFBLU.js";import{Hb as o,Ib as g,Jb as m,Pb as I,Qa as D,Rb as C,Ta as r,Tb as b,Ua as y,d as f,ha as w,ib as p,kb as l,lc as T,mc as M,oc as B,pa as u,qa as x,qb as n,qc as V,rb as i,sb as E,ub as h,xb as v,zb as s}from"./chunk-HBN3XZPF.js";function vt(e,c){e&1&&E(0,"app-loading-spinner")}function ft(e,c){if(e&1&&(n(0,"mat-option",23),o(1),i()),e&2){let t=c.$implicit;l("value",t),r(),m(" ",t," ")}}function gt(e,c){if(e&1&&(n(0,"div")(1,"strong"),o(2,"Started:"),i(),o(3),C(4,"date"),i()),e&2){let t=s(2);r(3),m(" ",b(4,1,t.entry.startedDate,"mediumDate")," ")}}function ht(e,c){if(e&1&&(n(0,"div")(1,"strong"),o(2,"Finished:"),i(),o(3),C(4,"date"),i()),e&2){let t=s(2);r(3),m(" ",b(4,1,t.entry.finishedDate,"mediumDate")," ")}}function Ct(e,c){if(e&1&&(n(0,"div")(1,"strong",15),o(2,"Published:"),i(),n(3,"p"),o(4),i()()),e&2){let t=s(2);r(4),g(t.book.publicationYear)}}function bt(e,c){if(e&1&&(n(0,"div")(1,"strong",15),o(2,"Pages:"),i(),n(3,"p"),o(4),i()()),e&2){let t=s(2);r(4),g(t.book.pageCount)}}function yt(e,c){if(e&1&&(n(0,"div")(1,"strong",15),o(2,"ISBN:"),i(),n(3,"p",24),o(4),i()()),e&2){let t=s(2);r(4),g(t.book.isbn)}}function kt(e,c){if(e&1&&(n(0,"span"),o(1),i()),e&2){let t=s(3);r(),m("H: ",t.book.dimensions.height," cm")}}function Et(e,c){if(e&1&&(n(0,"span"),o(1),i()),e&2){let t=s(3);r(),m(" \xD7 W: ",t.book.dimensions.width," cm")}}function St(e,c){if(e&1&&(n(0,"span"),o(1),i()),e&2){let t=s(3);r(),m(" \xD7 T: ",t.book.dimensions.thickness," cm")}}function Nt(e,c){if(e&1&&(n(0,"div",25)(1,"strong",15),o(2,"Dimensions:"),i(),n(3,"p",24),p(4,kt,2,1,"span",1)(5,Et,2,1,"span",1)(6,St,2,1,"span",1),i()()),e&2){let t=s(2);r(4),l("ngIf",t.book.dimensions.height),r(),l("ngIf",t.book.dimensions.width),r(),l("ngIf",t.book.dimensions.thickness)}}function wt(e,c){if(e&1&&(n(0,"div")(1,"strong",15),o(2,"Description:"),i(),n(3,"p",26),o(4),i()()),e&2){let t=s(2);r(4),g(t.book.description)}}function Dt(e,c){if(e&1){let t=h();n(0,"button",27),v("click",function(){u(t);let d=s(2);return x(d.showAddNoteForm())}),n(1,"mat-icon"),o(2,"add"),i()()}}function It(e,c){e&1&&(n(0,"mat-error"),o(1," Note content is required "),i())}function Tt(e,c){e&1&&(n(0,"mat-error"),o(1," Note cannot exceed 10,000 characters "),i())}function Mt(e,c){if(e&1){let t=h();n(0,"div",28)(1,"mat-form-field",7)(2,"mat-label"),o(3,"New Note"),i(),n(4,"textarea",29),o(5,"                "),i(),n(6,"mat-hint",30),o(7),i(),p(8,It,2,0,"mat-error",1)(9,Tt,2,0,"mat-error",1),i(),n(10,"div",31)(11,"button",32),v("click",function(){u(t);let d=s(2);return x(d.addNote())}),o(12," Save Note "),i(),n(13,"button",33),v("click",function(){u(t);let d=s(2);return x(d.cancelAddNote())}),o(14," Cancel "),i()()()}if(e&2){let t=s(2);r(4),l("formControl",t.newNoteControl),r(3),m("",(t.newNoteControl.value==null?null:t.newNoteControl.value.length)||0," / 10,000"),r(),l("ngIf",t.newNoteControl.hasError("required")),r(),l("ngIf",t.newNoteControl.hasError("maxlength")),r(2),l("disabled",!t.newNoteControl.valid)}}function Bt(e,c){if(e&1){let t=h();n(0,"div",34)(1,"mat-icon",35),o(2,"note_add"),i(),n(3,"p"),o(4,"No notes yet"),i(),n(5,"button",36),v("click",function(){u(t);let d=s(2);return x(d.showAddNoteForm())}),n(6,"mat-icon"),o(7,"add"),i(),o(8," Add First Note "),i()()}}function Vt(e,c){if(e&1&&(n(0,"span"),o(1),C(2,"date"),i()),e&2){let t=s(2).$implicit;r(),m(" \u2022 Edited ",b(2,1,t.updatedAt,"short")," ")}}function At(e,c){if(e&1){let t=h();n(0,"div")(1,"p",40),o(2),i(),n(3,"div",41)(4,"p",42),o(5),C(6,"date"),p(7,Vt,3,4,"span",1),i(),n(8,"div",43)(9,"button",44),v("click",function(){u(t);let d=s().$implicit,_=s(3);return x(_.startEditNote(d))}),n(10,"mat-icon",24),o(11,"edit"),i()(),n(12,"button",45),v("click",function(){u(t);let d=s().$implicit,_=s(3);return x(_.deleteNote(d))}),n(13,"mat-icon",24),o(14,"delete"),i()()()()()}if(e&2){let t=s().$implicit;r(2),g(t.content),r(3),m(" ",b(6,3,t.createdAt,"short")," "),r(2),l("ngIf",t.updatedAt.getTime()!==t.createdAt.getTime())}}function Ft(e,c){e&1&&(n(0,"mat-error"),o(1," Note content is required "),i())}function Lt(e,c){e&1&&(n(0,"mat-error"),o(1," Note cannot exceed 10,000 characters "),i())}function Rt(e,c){if(e&1){let t=h();n(0,"div")(1,"mat-form-field",7)(2,"mat-label"),o(3,"Edit Note"),i(),n(4,"textarea",46),o(5,"                    "),i(),n(6,"mat-hint",30),o(7),i(),p(8,Ft,2,0,"mat-error",1)(9,Lt,2,0,"mat-error",1),i(),n(10,"div",47)(11,"button",32),v("click",function(){u(t);let d=s().$implicit,_=s(3);return x(_.saveEditNote(d))}),o(12," Save "),i(),n(13,"button",33),v("click",function(){u(t);let d=s(4);return x(d.cancelEditNote())}),o(14," Cancel "),i()()()}if(e&2){let t=s(4);r(4),l("formControl",t.editNoteControl),r(3),m("",(t.editNoteControl.value==null?null:t.editNoteControl.value.length)||0," / 10,000"),r(),l("ngIf",t.editNoteControl.hasError("required")),r(),l("ngIf",t.editNoteControl.hasError("maxlength")),r(2),l("disabled",!t.editNoteControl.valid)}}function Ot(e,c){if(e&1&&(n(0,"div",39),p(1,At,15,6,"div",1)(2,Rt,15,5,"div",1),i()),e&2){let t=c.$implicit,a=s(3);r(),l("ngIf",a.editingNoteId!==t.id),r(),l("ngIf",a.editingNoteId===t.id)}}function $t(e,c){if(e&1&&(n(0,"div",37),p(1,Ot,3,2,"div",38),i()),e&2){let t=s(2);r(),l("ngForOf",t.notes)}}function jt(e,c){if(e&1){let t=h();n(0,"div")(1,"button",2),v("click",function(){u(t);let d=s();return x(d.goBack())}),n(2,"mat-icon"),o(3,"arrow_back"),i(),o(4," Back to Library "),i(),n(5,"div",3)(6,"div",4)(7,"mat-card"),E(8,"img",5),n(9,"mat-card-content",6)(10,"mat-form-field",7)(11,"mat-label"),o(12,"Reading Status"),i(),n(13,"mat-select",8),v("selectionChange",function(d){u(t);let _=s();return x(_.updateStatus(d.value))}),p(14,ft,2,2,"mat-option",9),i()(),n(15,"mat-chip",10),o(16),i(),n(17,"div",11),p(18,gt,5,4,"div",1)(19,ht,5,4,"div",1),n(20,"div")(21,"strong"),o(22,"Last Updated:"),i(),o(23),C(24,"date"),i()(),n(25,"button",12),v("click",function(){u(t);let d=s();return x(d.deleteBook())}),n(26,"mat-icon"),o(27,"delete"),i(),o(28," Delete Book "),i()()()(),n(29,"div",13)(30,"mat-card")(31,"mat-card-header")(32,"mat-card-title"),o(33),i(),n(34,"mat-card-subtitle"),o(35),i()(),n(36,"mat-card-content",6)(37,"div",14),p(38,Ct,5,1,"div",1)(39,bt,5,1,"div",1)(40,yt,5,1,"div",1),n(41,"div")(42,"strong",15),o(43,"Added:"),i(),n(44,"p"),o(45),C(46,"date"),i()()(),p(47,Nt,7,3,"div",16)(48,wt,5,1,"div",1),n(49,"div",17)(50,"mat-icon",18),o(51,"info"),i(),o(52),i()()(),n(53,"mat-card")(54,"mat-card-header")(55,"mat-card-title"),o(56,"Notes"),i(),p(57,Dt,3,0,"button",19),i(),n(58,"mat-card-content",6),p(59,Mt,15,5,"div",20)(60,Bt,9,0,"div",21)(61,$t,2,1,"div",22),i()()()()()}if(e&2){let t=s();r(8),l("src",t.book.coverImageUrl||"assets/placeholder-book.png",D)("alt",t.book.title),r(5),l("value",t.entry.status),r(),l("ngForOf",t.statuses),r(),l("color",t.getStatusColor(t.entry.status)),r(),m(" ",t.entry.status," "),r(2),l("ngIf",t.entry.startedDate),r(),l("ngIf",t.entry.finishedDate),r(4),m(" ",b(24,22,t.entry.lastUpdated,"mediumDate")," "),r(10),g(t.book.title),r(2),m("by ",t.book.author,""),r(3),l("ngIf",t.book.publicationYear),r(),l("ngIf",t.book.pageCount),r(),l("ngIf",t.book.isbn),r(5),g(b(46,25,t.book.addedAt,"mediumDate")),r(2),l("ngIf",t.book.dimensions),r(),l("ngIf",t.book.description),r(4),m(" Source: ",t.book.source==="google-books"?"Google Books":t.book.source==="open-library"?"Open Library":"Manual Entry"," "),r(5),l("ngIf",!t.isAddingNote&&t.notes.length>0),r(2),l("ngIf",t.isAddingNote),r(),l("ngIf",!t.isAddingNote&&t.notes.length===0),r(),l("ngIf",t.notes.length>0)}}var ue=(()=>{class e{constructor(t,a,d,_,xt){this.route=t,this.router=a,this.readingLog=d,this.dialog=_,this.snackBar=xt,this.book=null,this.entry=null,this.notes=[],this.isLoading=!0,this.statuses=["Not Started","Currently Reading","Completed","Did Not Finish"],this.isAddingNote=!1,this.newNoteControl=new S("",[k.required,k.maxLength(1e4)]),this.editingNoteId=null,this.editNoteControl=new S("",[k.required,k.maxLength(1e4)])}ngOnInit(){return f(this,null,function*(){let t=this.route.snapshot.paramMap.get("isbn");if(!t){this.router.navigate(["/library"]);return}yield this.loadBookDetails(t)})}loadBookDetails(t){return f(this,null,function*(){this.isLoading=!0;try{let a=yield this.readingLog.getBookWithEntry(t);if(!a){this.snackBar.open("Book not found","Close",{duration:3e3}),this.router.navigate(["/library"]);return}this.book=a.book,this.entry=a.entry,this.notes=yield this.readingLog.getNotesForEntry(a.entry.id)}catch(a){console.error("Error loading book details:",a),this.snackBar.open("Error loading book details","Close",{duration:3e3})}finally{this.isLoading=!1}})}updateStatus(t){return f(this,null,function*(){if(this.entry)try{yield this.readingLog.updateStatus(this.entry.id,t),this.entry.status=t,t==="Currently Reading"&&!this.entry.startedDate&&(this.entry.startedDate=new Date),(t==="Completed"||t==="Did Not Finish")&&!this.entry.finishedDate&&(this.entry.finishedDate=new Date),this.entry.lastUpdated=new Date,this.snackBar.open("Status updated!","Close",{duration:2e3})}catch(a){console.error("Error updating status:",a),this.snackBar.open("Error updating status","Close",{duration:3e3})}})}getStatusColor(t){switch(t){case"Not Started":return"default";case"Currently Reading":return"primary";case"Completed":return"accent";case"Did Not Finish":return"warn";default:return"default"}}deleteBook(){return f(this,null,function*(){if(!this.book)return;this.dialog.open(N,{data:{title:"Delete Book",message:`Are you sure you want to delete "${this.book.title}"? This will also delete all notes.`,confirmText:"Delete",cancelText:"Cancel"}}).afterClosed().subscribe(a=>f(this,null,function*(){if(a&&this.book)try{yield this.readingLog.deleteBook(this.book.isbn),this.snackBar.open("Book deleted","Close",{duration:2e3}),this.router.navigate(["/library"])}catch(d){console.error("Error deleting book:",d),this.snackBar.open("Error deleting book","Close",{duration:3e3})}}))})}goBack(){this.router.navigate(["/library"])}showAddNoteForm(){this.isAddingNote=!0,this.newNoteControl.reset()}cancelAddNote(){this.isAddingNote=!1,this.newNoteControl.reset()}addNote(){return f(this,null,function*(){if(!this.entry||!this.newNoteControl.valid)return;let t=this.newNoteControl.value?.trim();if(t)try{let d={id:yield this.readingLog.addNote(this.entry.id,t),readingEntryId:this.entry.id,content:t,createdAt:new Date,updatedAt:new Date};this.notes.unshift(d),this.snackBar.open("Note added!","Close",{duration:2e3}),this.isAddingNote=!1,this.newNoteControl.reset()}catch(a){console.error("Error adding note:",a),this.snackBar.open("Error adding note","Close",{duration:3e3})}})}startEditNote(t){this.editingNoteId=t.id,this.editNoteControl.setValue(t.content)}cancelEditNote(){this.editingNoteId=null,this.editNoteControl.reset()}saveEditNote(t){return f(this,null,function*(){if(!this.editNoteControl.valid)return;let a=this.editNoteControl.value?.trim();if(a)try{yield this.readingLog.updateNote(t.id,a),t.content=a,t.updatedAt=new Date,this.snackBar.open("Note updated!","Close",{duration:2e3}),this.editingNoteId=null,this.editNoteControl.reset()}catch(d){console.error("Error updating note:",d),this.snackBar.open("Error updating note","Close",{duration:3e3})}})}deleteNote(t){return f(this,null,function*(){this.dialog.open(N,{data:{title:"Delete Note",message:"Are you sure you want to delete this note?",confirmText:"Delete",cancelText:"Cancel"}}).afterClosed().subscribe(d=>f(this,null,function*(){if(d)try{yield this.readingLog.deleteNote(t.id),this.notes=this.notes.filter(_=>_.id!==t.id),this.snackBar.open("Note deleted","Close",{duration:2e3})}catch(_){console.error("Error deleting note:",_),this.snackBar.open("Error deleting note","Close",{duration:3e3})}}))})}static{this.\u0275fac=function(a){return new(a||e)(y(A),y(F),y(st),y(ut),y(pt))}}static{this.\u0275cmp=w({type:e,selectors:[["app-detail"]],standalone:!0,features:[I],decls:3,vars:2,consts:[[1,"container","mx-auto","p-4","max-w-4xl"],[4,"ngIf"],["mat-button","",1,"mb-4",3,"click"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-6"],[1,"md:col-span-1"],[1,"w-full","h-auto","rounded",3,"src","alt"],[1,"mt-4"],["appearance","outline",1,"w-full"],[3,"selectionChange","value"],[3,"value",4,"ngFor","ngForOf"],[1,"w-full","justify-center","mb-4",3,"color"],[1,"text-sm","space-y-2","mb-4"],["mat-stroked-button","","color","warn",1,"w-full",3,"click"],[1,"md:col-span-2","space-y-6"],[1,"grid","grid-cols-2","gap-4","mb-4"],[1,"text-gray-600"],["class","mb-4",4,"ngIf"],[1,"mt-4","text-xs","text-gray-500"],[1,"text-xs","align-middle"],["mat-icon-button","","color","primary","aria-label","Add note",3,"click",4,"ngIf"],["class","mb-6 p-4 border border-gray-300 rounded",4,"ngIf"],["class","text-center py-8 text-gray-500",4,"ngIf"],["class","space-y-4",4,"ngIf"],[3,"value"],[1,"text-sm"],[1,"mb-4"],[1,"text-sm","mt-2"],["mat-icon-button","","color","primary","aria-label","Add note",3,"click"],[1,"mb-6","p-4","border","border-gray-300","rounded"],["matInput","","rows","4","placeholder","Write your thoughts about this book...","maxlength","10000",3,"formControl"],["align","end"],[1,"flex","gap-2"],["mat-raised-button","","color","primary",3,"click","disabled"],["mat-button","",3,"click"],[1,"text-center","py-8","text-gray-500"],[1,"text-4xl","mb-2"],["mat-raised-button","","color","primary",1,"mt-2",3,"click"],[1,"space-y-4"],["class","border-l-4 border-blue-500 pl-4 py-2",4,"ngFor","ngForOf"],[1,"border-l-4","border-blue-500","pl-4","py-2"],[1,"text-sm","whitespace-pre-wrap"],[1,"flex","items-center","justify-between","mt-2"],[1,"text-xs","text-gray-500"],[1,"flex","gap-1"],["mat-icon-button","","color","primary","aria-label","Edit note",3,"click"],["mat-icon-button","","color","warn","aria-label","Delete note",3,"click"],["matInput","","rows","4","maxlength","10000",3,"formControl"],[1,"flex","gap-2","mt-2"]],template:function(a,d){a&1&&(n(0,"div",0),p(1,vt,1,0,"app-loading-spinner",1)(2,jt,62,28,"div",1),i()),a&2&&(r(),l("ngIf",d.isLoading),r(),l("ngIf",!d.isLoading&&d.book&&d.entry))},dependencies:[V,T,M,B,X,G,J,Q,K,$,R,O,q,j,z,U,P,Y,W,H,rt,ot,lt,it,Z,et,tt,dt,L,nt,mt,ct,_t,at]})}}return e})();export{ue as DetailComponent};
