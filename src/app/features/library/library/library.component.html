<div class="container mx-auto p-4 max-w-7xl">
  <div class="flex justify-between items-center mb-6">
    <h1 class="text-3xl font-bold">My Library</h1>
    <button mat-raised-button color="primary" (click)="goToSearch()">
      <mat-icon>add</mat-icon>
      Add Books
    </button>
  </div>

  <!-- Loading -->
  <app-loading-spinner *ngIf="isLoading"></app-loading-spinner>

  <!-- Filter Bar -->
  <app-filter-bar
    *ngIf="!isLoading && allBooks.length > 0"
    [selectedStatuses]="selectedStatuses"
    (statusesChanged)="onStatusFilterChange($event)">
  </app-filter-bar>

  <!-- Empty State -->
  <div *ngIf="!isLoading && allBooks.length === 0" class="text-center py-16">
    <mat-icon class="text-8xl text-gray-300 mb-4">library_books</mat-icon>
    <h2 class="text-2xl font-semibold mb-2">Your library is empty</h2>
    <p class="text-gray-600 mb-6">Start building your reading collection</p>
    <button mat-raised-button color="primary" (click)="goToSearch()">
      <mat-icon>search</mat-icon>
      Search for Books
    </button>
  </div>

  <!-- No Results After Filtering -->
  <div *ngIf="!isLoading && allBooks.length > 0 && filteredBooks.length === 0" class="text-center py-16">
    <mat-icon class="text-6xl text-gray-400 mb-4">filter_alt_off</mat-icon>
    <h2 class="text-xl font-semibold mb-2">No books match your filters</h2>
    <p class="text-gray-600">Try adjusting your status filters</p>
  </div>

  <!-- Books Grid -->
  <div *ngIf="!isLoading && filteredBooks.length > 0">
    <p class="text-gray-600 mb-4">
      {{filteredBooks.length}} book{{filteredBooks.length !== 1 ? 's' : ''}}
      <span *ngIf="selectedStatuses.length > 0"> matching your filters</span>
      <span *ngIf="selectedStatuses.length === 0"> in your library</span>
    </p>

    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4">
      <mat-card *ngFor="let item of filteredBooks" class="cursor-pointer hover:shadow-xl transition-shadow"
                (click)="viewBookDetail(item.book.isbn)">
        <img
          mat-card-image
          [src]="item.book.coverImageUrl || 'assets/placeholder-book.png'"
          [alt]="item.book.title"
          class="h-48 object-cover"
          loading="lazy"
        >
        <mat-card-content class="p-3">
          <h3 class="font-semibold text-base mb-1 line-clamp-2">{{item.book.title}}</h3>
          <p class="text-sm text-gray-600 mb-2 line-clamp-1">{{item.book.author}}</p>

          <div class="flex items-center justify-between">
            <mat-chip class="text-xs" [color]="getStatusColor(item.entry.status)">
              {{item.entry.status}}
            </mat-chip>
            <span class="text-xs text-gray-500" *ngIf="item.book.pageCount">
              {{item.book.pageCount}} pages
            </span>
          </div>
        </mat-card-content>
        <mat-card-actions class="p-3 pt-0">
          <button mat-button color="primary" class="w-full">
            View Details
          </button>
        </mat-card-actions>
      </mat-card>
    </div>
  </div>
</div>
