<div class="container mx-auto p-4 max-w-7xl">
  <h1 class="text-3xl font-bold mb-6">Reading Statistics</h1>

  <!-- Loading -->
  <app-loading-spinner *ngIf="isLoading"></app-loading-spinner>

  <!-- Statistics Dashboard -->
  <div *ngIf="!isLoading && stats">
    <!-- Summary Cards -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
      <!-- Total Books -->
      <mat-card class="text-center">
        <mat-card-content class="p-6">
          <mat-icon class="text-5xl text-blue-500 mb-2">library_books</mat-icon>
          <h2 class="text-3xl font-bold mb-1">{{stats.totalBooks}}</h2>
          <p class="text-gray-600">Total Books</p>
        </mat-card-content>
      </mat-card>

      <!-- Completed Books -->
      <mat-card class="text-center">
        <mat-card-content class="p-6">
          <mat-icon class="text-5xl text-green-500 mb-2">check_circle</mat-icon>
          <h2 class="text-3xl font-bold mb-1">{{stats.completed}}</h2>
          <p class="text-gray-600">Completed</p>
        </mat-card-content>
      </mat-card>

      <!-- Currently Reading -->
      <mat-card class="text-center">
        <mat-card-content class="p-6">
          <mat-icon class="text-5xl text-orange-500 mb-2">auto_stories</mat-icon>
          <h2 class="text-3xl font-bold mb-1">{{stats.currentlyReading}}</h2>
          <p class="text-gray-600">Currently Reading</p>
        </mat-card-content>
      </mat-card>

      <!-- Total Pages -->
      <mat-card class="text-center">
        <mat-card-content class="p-6">
          <mat-icon class="text-5xl text-purple-500 mb-2">menu_book</mat-icon>
          <h2 class="text-3xl font-bold mb-1">{{totalPagesRead | number}}</h2>
          <p class="text-gray-600">Pages Read</p>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Additional Stats -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
      <!-- Completion Rate -->
      <mat-card>
        <mat-card-header>
          <mat-card-title>Completion Rate</mat-card-title>
        </mat-card-header>
        <mat-card-content class="text-center p-6">
          <div class="relative inline-block">
            <mat-progress-spinner
              mode="determinate"
              [value]="stats.completionRate"
              [diameter]="120"
              [strokeWidth]="10"
              color="accent">
            </mat-progress-spinner>
            <div class="absolute inset-0 flex items-center justify-center">
              <span class="text-2xl font-bold">{{stats.completionRate | number:'1.0-1'}}%</span>
            </div>
          </div>
          <p class="text-gray-600 mt-4">
            {{stats.completed}} completed out of {{stats.completed + stats.didNotFinish}} attempted
          </p>
        </mat-card-content>
      </mat-card>

      <!-- Average Reading Time -->
      <mat-card>
        <mat-card-header>
          <mat-card-title>Average Reading Time</mat-card-title>
        </mat-card-header>
        <mat-card-content class="text-center p-6">
          <mat-icon class="text-6xl text-blue-500 mb-2">schedule</mat-icon>
          <h2 class="text-3xl font-bold mb-1">
            {{stats.averageReadingTimeInDays || 0}}
          </h2>
          <p class="text-gray-600">Days per book</p>
          <p class="text-sm text-gray-500 mt-2" *ngIf="stats.averageReadingTimeInDays">
            Based on {{stats.completed}} completed books
          </p>
        </mat-card-content>
      </mat-card>

      <!-- Not Started -->
      <mat-card>
        <mat-card-header>
          <mat-card-title>Reading Queue</mat-card-title>
        </mat-card-header>
        <mat-card-content class="text-center p-6">
          <mat-icon class="text-6xl text-gray-500 mb-2">bookmark_border</mat-icon>
          <h2 class="text-3xl font-bold mb-1">{{stats.notStarted}}</h2>
          <p class="text-gray-600">Not Started</p>
          <p class="text-sm text-gray-500 mt-2" *ngIf="stats.didNotFinish > 0">
            {{stats.didNotFinish}} did not finish
          </p>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Status Distribution -->
    <mat-card class="mb-6">
      <mat-card-header>
        <mat-card-title>Status Distribution</mat-card-title>
      </mat-card-header>
      <mat-card-content class="p-6">
        <div *ngIf="statusDistribution.length > 0" class="space-y-4">
          <div *ngFor="let item of statusDistribution" class="flex items-center gap-4">
            <div class="w-40 font-medium">{{item.status}}</div>
            <div class="flex-1">
              <div class="bg-gray-200 rounded-full h-8 relative">
                <div
                  class="h-8 rounded-full flex items-center justify-end pr-2 text-white text-sm font-medium"
                  [style.width.%]="item.percentage"
                  [ngClass]="{
                    'bg-gray-500': item.status === 'Not Started',
                    'bg-blue-500': item.status === 'Currently Reading',
                    'bg-green-500': item.status === 'Completed',
                    'bg-red-500': item.status === 'Did Not Finish'
                  }">
                  <span *ngIf="item.percentage > 10">{{item.count}}</span>
                </div>
              </div>
            </div>
            <div class="w-20 text-right font-medium">
              {{item.percentage | number:'1.0-1'}}%
            </div>
          </div>
        </div>
        <div *ngIf="statusDistribution.length === 0" class="text-center py-8 text-gray-500">
          <p>No data available yet</p>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Books Read Per Month -->
    <mat-card>
      <mat-card-header>
        <mat-card-title>Books Completed This Year</mat-card-title>
      </mat-card-header>
      <mat-card-content class="p-6">
        <div class="flex items-end justify-between gap-2 h-64">
          <div *ngFor="let month of booksPerMonth" class="flex-1 flex flex-col items-center">
            <div class="flex-1 flex items-end w-full">
              <div
                class="w-full bg-blue-500 rounded-t hover:bg-blue-600 transition-colors cursor-pointer"
                [style.height.%]="month.count > 0 ? (month.count / getMaxMonthCount() * 100) : 5"
                [title]="month.month + ': ' + month.count + ' books'">
              </div>
            </div>
            <div class="text-xs text-gray-600 mt-2">{{month.month}}</div>
          </div>
        </div>
        <div class="text-center mt-4 text-sm text-gray-600">
          Total completed this year: {{getTotalBooksThisYear()}}
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- Empty State -->
  <div *ngIf="!isLoading && stats && stats.totalBooks === 0" class="text-center py-16">
    <mat-icon class="text-8xl text-gray-300 mb-4">insert_chart</mat-icon>
    <h2 class="text-2xl font-semibold mb-2">No statistics yet</h2>
    <p class="text-gray-600 mb-6">Add books to your library to see your reading statistics</p>
  </div>
</div>
