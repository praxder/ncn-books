import{a as H,b as Q,c as q}from"./chunk-PNK3MDVW.js";import{a as Y,b as J,c as K,f as $,h as W}from"./chunk-COWIBSMX.js";import{b as z}from"./chunk-KW5VBN5V.js";import{U as j,V as L}from"./chunk-PT23TE2W.js";import{Hb as n,Ib as u,Jb as b,Kb as w,Pb as M,Qb as T,Rb as _,Sb as F,Ta as r,Tb as E,Ua as k,_ as C,d as x,da as I,ha as R,ib as f,kb as c,kc as N,lb as D,lc as P,mc as B,pc as O,qb as i,qc as A,rb as e,sb as y,zb as v}from"./chunk-HBN3XZPF.js";var G=(()=>{class a{constructor(t){this.storage=t}getReadingStats(){return x(this,null,function*(){let t=yield this.storage.getAllReadingEntries(),o={totalBooks:t.length,notStarted:0,currentlyReading:0,completed:0,didNotFinish:0,completionRate:0,averageReadingTimeInDays:null};t.forEach(s=>{switch(s.status){case"Not Started":o.notStarted++;break;case"Currently Reading":o.currentlyReading++;break;case"Completed":o.completed++;break;case"Did Not Finish":o.didNotFinish++;break}});let l=o.completed+o.didNotFinish;l>0&&(o.completionRate=o.completed/l*100);let m=t.filter(s=>s.status==="Completed"&&s.startedDate&&s.finishedDate);if(m.length>0){let s=m.reduce((d,g)=>{let S=new Date(g.startedDate),h=new Date(g.finishedDate),U=Math.ceil((h.getTime()-S.getTime())/(1e3*60*60*24));return d+U},0);o.averageReadingTimeInDays=Math.round(s/m.length)}return o})}getStatusDistribution(){return x(this,null,function*(){let t=yield this.storage.getAllReadingEntries(),o=t.length;if(o===0)return[];let l={"Not Started":0,"Currently Reading":0,Completed:0,"Did Not Finish":0};return t.forEach(m=>{l[m.status]++}),Object.entries(l).map(([m,s])=>({status:m,count:s,percentage:s/o*100}))})}getReadingTrends(t=30){return x(this,null,function*(){let o=yield this.storage.getAllReadingEntries(),l=new Date,m=new Date(l);m.setDate(m.getDate()-t);let s=new Map;for(let d=new Date(m);d<=l;d.setDate(d.getDate()+1)){let g=d.toISOString().split("T")[0];s.set(g,{date:new Date(d),completed:0,started:0})}return o.forEach(d=>{if(d.startedDate){let g=new Date(d.startedDate);if(g>=m){let S=g.toISOString().split("T")[0],h=s.get(S);h&&h.started++}}if(d.finishedDate&&d.status==="Completed"){let g=new Date(d.finishedDate);if(g>=m){let S=g.toISOString().split("T")[0],h=s.get(S);h&&h.completed++}}}),Array.from(s.values()).sort((d,g)=>d.date.getTime()-g.date.getTime())})}getBooksReadPerMonth(){return x(this,null,function*(){let t=yield this.storage.getAllReadingEntries(),o=new Date().getFullYear(),l=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],m=new Array(12).fill(0);return t.forEach(s=>{if(s.finishedDate&&s.status==="Completed"){let d=new Date(s.finishedDate);d.getFullYear()===o&&m[d.getMonth()]++}}),l.map((s,d)=>({month:s,count:m[d]}))})}getTotalPagesRead(){return x(this,null,function*(){let t=yield this.storage.getReadingEntriesByStatus("Completed"),o=0;for(let l of t){let m=yield this.storage.getBook(l.isbn);m?.pageCount&&(o+=m.pageCount)}return o})}static{this.\u0275fac=function(o){return new(o||a)(I(z))}}static{this.\u0275prov=C({token:a,factory:a.\u0275fac,providedIn:"root"})}}return a})();var Z=(a,p,t,o)=>({"bg-gray-500":a,"bg-blue-500":p,"bg-green-500":t,"bg-red-500":o});function tt(a,p){a&1&&y(0,"app-loading-spinner")}function et(a,p){if(a&1&&(i(0,"p",29),n(1),e()),a&2){let t=v(2);r(),b(" Based on ",t.stats.completed," completed books ")}}function it(a,p){if(a&1&&(i(0,"p",29),n(1),e()),a&2){let t=v(2);r(),b(" ",t.stats.didNotFinish," did not finish ")}}function at(a,p){if(a&1&&(i(0,"span"),n(1),e()),a&2){let t=v().$implicit;r(),u(t.count)}}function nt(a,p){if(a&1&&(i(0,"div",32)(1,"div",33),n(2),e(),i(3,"div",34)(4,"div",35)(5,"div",36),f(6,at,2,1,"span",2),e()()(),i(7,"div",37),n(8),_(9,"number"),e()()),a&2){let t=p.$implicit;r(2),u(t.status),r(3),D("width",t.percentage,"%"),c("ngClass",T(9,Z,t.status==="Not Started",t.status==="Currently Reading",t.status==="Completed",t.status==="Did Not Finish")),r(),c("ngIf",t.percentage>10),r(2),b(" ",E(9,6,t.percentage,"1.0-1"),"% ")}}function ot(a,p){if(a&1&&(i(0,"div",30),f(1,nt,10,14,"div",31),e()),a&2){let t=v(2);r(),c("ngForOf",t.statusDistribution)}}function rt(a,p){a&1&&(i(0,"div",38)(1,"p"),n(2,"No data available yet"),e()())}function st(a,p){if(a&1&&(i(0,"div",39)(1,"div",40),y(2,"div",41),e(),i(3,"div",42),n(4),e()()),a&2){let t=p.$implicit,o=v(2);r(2),D("height",t.count>0?t.count/o.getMaxMonthCount()*100:5,"%"),c("title",t.month+": "+t.count+" books"),r(2),u(t.month)}}function dt(a,p){if(a&1&&(i(0,"div")(1,"div",4)(2,"mat-card",5)(3,"mat-card-content",6)(4,"mat-icon",7),n(5,"library_books"),e(),i(6,"h2",8),n(7),e(),i(8,"p",9),n(9,"Total Books"),e()()(),i(10,"mat-card",5)(11,"mat-card-content",6)(12,"mat-icon",10),n(13,"check_circle"),e(),i(14,"h2",8),n(15),e(),i(16,"p",9),n(17,"Completed"),e()()(),i(18,"mat-card",5)(19,"mat-card-content",6)(20,"mat-icon",11),n(21,"auto_stories"),e(),i(22,"h2",8),n(23),e(),i(24,"p",9),n(25,"Currently Reading"),e()()(),i(26,"mat-card",5)(27,"mat-card-content",6)(28,"mat-icon",12),n(29,"menu_book"),e(),i(30,"h2",8),n(31),_(32,"number"),e(),i(33,"p",9),n(34,"Pages Read"),e()()()(),i(35,"div",13)(36,"mat-card")(37,"mat-card-header")(38,"mat-card-title"),n(39,"Completion Rate"),e()(),i(40,"mat-card-content",14)(41,"div",15),y(42,"mat-progress-spinner",16),i(43,"div",17)(44,"span",18),n(45),_(46,"number"),e()()(),i(47,"p",19),n(48),e()()(),i(49,"mat-card")(50,"mat-card-header")(51,"mat-card-title"),n(52,"Average Reading Time"),e()(),i(53,"mat-card-content",14)(54,"mat-icon",20),n(55,"schedule"),e(),i(56,"h2",8),n(57),e(),i(58,"p",9),n(59,"Days per book"),e(),f(60,et,2,1,"p",21),e()(),i(61,"mat-card")(62,"mat-card-header")(63,"mat-card-title"),n(64,"Reading Queue"),e()(),i(65,"mat-card-content",14)(66,"mat-icon",22),n(67,"bookmark_border"),e(),i(68,"h2",8),n(69),e(),i(70,"p",9),n(71,"Not Started"),e(),f(72,it,2,1,"p",21),e()()(),i(73,"mat-card",23)(74,"mat-card-header")(75,"mat-card-title"),n(76,"Status Distribution"),e()(),i(77,"mat-card-content",6),f(78,ot,2,1,"div",24)(79,rt,3,0,"div",25),e()(),i(80,"mat-card")(81,"mat-card-header")(82,"mat-card-title"),n(83,"Books Completed This Year"),e()(),i(84,"mat-card-content",6)(85,"div",26),f(86,st,5,4,"div",27),e(),i(87,"div",28),n(88),e()()()()),a&2){let t=v();r(7),u(t.stats.totalBooks),r(8),u(t.stats.completed),r(8),u(t.stats.currentlyReading),r(8),u(F(32,18,t.totalPagesRead)),r(11),c("value",t.stats.completionRate)("diameter",120)("strokeWidth",10),r(3),b("",E(46,20,t.stats.completionRate,"1.0-1"),"%"),r(3),w(" ",t.stats.completed," completed out of ",t.stats.completed+t.stats.didNotFinish," attempted "),r(9),b(" ",t.stats.averageReadingTimeInDays||0," "),r(3),c("ngIf",t.stats.averageReadingTimeInDays),r(9),u(t.stats.notStarted),r(3),c("ngIf",t.stats.didNotFinish>0),r(6),c("ngIf",t.statusDistribution.length>0),r(),c("ngIf",t.statusDistribution.length===0),r(7),c("ngForOf",t.booksPerMonth),r(2),b(" Total completed this year: ",t.getTotalBooksThisYear()," ")}}function lt(a,p){a&1&&(i(0,"div",43)(1,"mat-icon",44),n(2,"insert_chart"),e(),i(3,"h2",45),n(4,"No statistics yet"),e(),i(5,"p",46),n(6,"Add books to your library to see your reading statistics"),e()())}var yt=(()=>{class a{constructor(t){this.statisticsService=t,this.stats=null,this.statusDistribution=[],this.booksPerMonth=[],this.totalPagesRead=0,this.isLoading=!0}ngOnInit(){return x(this,null,function*(){yield this.loadStatistics()})}loadStatistics(){return x(this,null,function*(){this.isLoading=!0;try{[this.stats,this.statusDistribution,this.booksPerMonth,this.totalPagesRead]=yield Promise.all([this.statisticsService.getReadingStats(),this.statisticsService.getStatusDistribution(),this.statisticsService.getBooksReadPerMonth(),this.statisticsService.getTotalPagesRead()])}catch(t){console.error("Error loading statistics:",t)}finally{this.isLoading=!1}})}getStatusColor(t){switch(t){case"Not Started":return"default";case"Currently Reading":return"primary";case"Completed":return"accent";case"Did Not Finish":return"warn";default:return"default"}}getMaxMonthCount(){return Math.max(...this.booksPerMonth.map(t=>t.count),1)}getTotalBooksThisYear(){return this.booksPerMonth.reduce((t,o)=>t+o.count,0)}static{this.\u0275fac=function(o){return new(o||a)(k(G))}}static{this.\u0275cmp=R({type:a,selectors:[["app-dashboard"]],standalone:!0,features:[M],decls:6,vars:3,consts:[[1,"container","mx-auto","p-4","max-w-7xl"],[1,"text-3xl","font-bold","mb-6"],[4,"ngIf"],["class","text-center py-16",4,"ngIf"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-4","gap-4","mb-6"],[1,"text-center"],[1,"p-6"],[1,"text-5xl","text-blue-500","mb-2"],[1,"text-3xl","font-bold","mb-1"],[1,"text-gray-600"],[1,"text-5xl","text-green-500","mb-2"],[1,"text-5xl","text-orange-500","mb-2"],[1,"text-5xl","text-purple-500","mb-2"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-4","mb-6"],[1,"text-center","p-6"],[1,"relative","inline-block"],["mode","determinate","color","accent",3,"value","diameter","strokeWidth"],[1,"absolute","inset-0","flex","items-center","justify-center"],[1,"text-2xl","font-bold"],[1,"text-gray-600","mt-4"],[1,"text-6xl","text-blue-500","mb-2"],["class","text-sm text-gray-500 mt-2",4,"ngIf"],[1,"text-6xl","text-gray-500","mb-2"],[1,"mb-6"],["class","space-y-4",4,"ngIf"],["class","text-center py-8 text-gray-500",4,"ngIf"],[1,"flex","items-end","justify-between","gap-2","h-64"],["class","flex-1 flex flex-col items-center",4,"ngFor","ngForOf"],[1,"text-center","mt-4","text-sm","text-gray-600"],[1,"text-sm","text-gray-500","mt-2"],[1,"space-y-4"],["class","flex items-center gap-4",4,"ngFor","ngForOf"],[1,"flex","items-center","gap-4"],[1,"w-40","font-medium"],[1,"flex-1"],[1,"bg-gray-200","rounded-full","h-8","relative"],[1,"h-8","rounded-full","flex","items-center","justify-end","pr-2","text-white","text-sm","font-medium",3,"ngClass"],[1,"w-20","text-right","font-medium"],[1,"text-center","py-8","text-gray-500"],[1,"flex-1","flex","flex-col","items-center"],[1,"flex-1","flex","items-end","w-full"],[1,"w-full","bg-blue-500","rounded-t","hover:bg-blue-600","transition-colors","cursor-pointer",3,"title"],[1,"text-xs","text-gray-600","mt-2"],[1,"text-center","py-16"],[1,"text-8xl","text-gray-300","mb-4"],[1,"text-2xl","font-semibold","mb-2"],[1,"text-gray-600","mb-6"]],template:function(o,l){o&1&&(i(0,"div",0)(1,"h1",1),n(2,"Reading Statistics"),e(),f(3,tt,1,0,"app-loading-spinner",2)(4,dt,89,23,"div",2)(5,lt,7,0,"div",3),e()),o&2&&(r(3),c("ngIf",l.isLoading),r(),c("ngIf",!l.isLoading&&l.stats),r(),c("ngIf",!l.isLoading&&l.stats&&l.stats.totalBooks===0))},dependencies:[A,N,P,B,O,W,Y,K,$,J,L,j,Q,H,q]})}}return a})();export{yt as DashboardComponent};
